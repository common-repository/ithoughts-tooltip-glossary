/*! ithoughts-tooltip-glossary build on 2018-04-23 11:02:11 for v3.0.3 */
/**
 * @file Client-side scripts for handling tooltip creation wizzard in Wordpress TinyMCE
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.7.0
 */
"use strict";!function(a){var b=a.$,c=a.$d,d=a.$w,e=iThoughtsTooltipGlossaryEditor;c.ready(function(){function a(a,c){a.click(function(){b(this).parent().find(".active").removeClass("active"),b(this).addClass("active");var a=b(this).index();b(this).parent().parent().find(" > .active").removeClass("active"),b(b(this).parent().parent().children()[a+1]).addClass("active"),c&&c(a)}),a.filter(".active").click()}var c="";if(1===b("#ithoughts_tt_gl-tooltip-form-container").length)c="TIP";else{if(1!==b("#ithoughts_tt_gl-list-form-container").length)return void e.error("Does not contains a tooltip form nor a list form, exit");c="LIST"}"TIP"===c?function(){function c(a){try{tinymce.EditorManager.execCommand("mceRemoveEditor",!0,a)}catch(b){iThoughtsTooltipGlossary.warn("Force cleaning needed: ",b),tinymce.EditorManager.editors=tinymce.EditorManager.editors.filter(function(b){return b.id!==a})}}function f(a){setTimeout(function(){c("ithoughts_tt_gl-tooltip-content")},500),e.finishTipTinymce(a)}var g;a(b("#ithoughts_tt_gl-tooltip-form .tabs li"),function(a){b("#ithoughts_tt_gl_link").prop("disabled",0===a)}),a(b("#ithoughts_tt_gl-tooltip-form-options .tabs li")),b(".modeswitcher").on("click keyup",function(){var a=this.id;b("[data-"+a+"]:not([data-"+a+'="mediatip-'+this.value+'-type"])').hide(),b("[data-"+a+'~="mediatip-'+this.value+'-type"]').show()}).keyup(),function(a){a.each(function(a,c){for(;null==c.getAttribute("id");){var d="editor"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10);0===b(d).length&&c.setAttribute("id",d)}var f=c.getAttribute("id"),g=c.value;tinymce.init({selector:"#"+f,menubar:!1,external_plugins:{code:e.base_tinymce+"/code/plugin.min.js",wordcount:e.base_tinymce+"/wordcount/plugin.min.js"},plugins:"wplink",toolbar:["styleselect | bold italic underline link | bullist numlist | alignleft aligncenter alignright alignjustify | code"],min_height:70,height:70,resize:!1});var h=setInterval(function(){var a=tinymce.get(f);a&&a.getDoc()&&a.getBody()&&(e.log("Initing subeditor with content ",JSON.stringify(g)),clearInterval(h),a.setContent(g.replace(/&/g,"&amp;")))},50)})}(b("#ithoughts_tt_gl-tooltip-form-container .tinymce")),b("#ithoughts_tt_gl_select_image").click(function(){var a=wp.media({frame:"post",state:"insert",library:{type:["audio","video","image"]},multiple:!1});a.on("insert",function(){var c=a.state().get("selection").first();null!=c&&(c=c.toJSON(),b("#image-box-data").val(JSON.stringify({url:c.url,id:c.id,link:c.link})),b("#image-box").html('<img src="'+c.url+'"/>'),b("#mediatip_caption").val(c.caption),b("#ithoughts_tt_gl_link").val(c.link))}),a.open()}),function(){function a(){setTimeout(function(){h.find("*:focus").length||g.is(":focus")||i.addClass("hidden")},100)}function c(){var a=[],c=[];e.terms.map(function(b){var d=b.title.toLowerCase().indexOf(j);if(-1===d&&(d=b.slug.toLowerCase().indexOf(j)),-1!==d)return 0===d?void a.push(b):void c.push(b)});var d=a.concat(c).filter(function(a,b,c){return c.indexOf(a)===b});h.empty();var k=d.length;if(k>0)for(var l=0;l<k;l++){var m=d[l];void 0!==m.thislang&&!1===m.thislang?h.append(b.parseHTML('<div tabindex="0" class="option foreign-language" data-id="'+m.id+'" data-excerpt="'+m.content+'"><p><b>'+m.title+"</b><br><em>"+m.slug+"</em></p></div>")):h.append(b.parseHTML('<div tabindex="0" class="option" data-id="'+m.id+'" data-excerpt="'+m.content+'"><p><b>'+m.title+"</b><br><em>"+m.slug+"</em></p></div>"))}else h.append(b.parseHTML('<p style="text-align:center"><em>No results</em><p>'));i.removeClass("hidden"),setTimeout(f,25),h.find(".option").on("click",function(a){b('[name="glossary_term_id"]').val(a.currentTarget.getAttribute("data-id")),g.val(b(a.currentTarget).find("p > b").text()),i.addClass("hidden")})}function f(){var a=h.offset().top-d.scrollTop(),b=d.height(),c=b-a;i.css({maxHeight:c})}var g=b("#glossary_term"),h=b("#glossary_term_completer"),i=b(".glossary_term_completer_container"),j="",k=null;d.resize(f),g.on("keyup focusin",function(){k&&k.abort(),j=e.removeAccents(b(this).val().toLowerCase()),c(),k=b.ajax({url:e.admin_ajax,method:"POST",dataType:"json",data:{action:"ithoughts_tt_gl_get_terms_list",search:j},complete:function(a){var b=a.responseJSON;if(void 0!==b&&b.success){if(b.data.searched!==j)return void iThoughtsTooltipGlossary.info("Outdated response");e.terms=b.data.terms,c()}}})}).on("focusout",a).on("keyup",function(){this.removeAttribute("data-term-id")})}(),function(){function a(){for(var a,c=i[0],d=c.elements,e={},f=!0,g=d.length,h=-1,j={},k=b("#attributes-list option").map(function(){return this.value}).toArray(),l=["span","link"];++h<g&&f;){var m=d[h].validity;f&=m.valid,m.valid||d[h].focus()}for(i.find(".ithoughts-tristate").each(function(){b.extend(!0,e,b(this).serializeInputsObject({"-1":!1,0:null,1:!0}[this.dataset.state]))}),a=b.extend(!0,i.serializeObject(),e),h=0;h<2;h++){var n=l[h];j[n]={};for(var o=a["attributes-"+n+"-key"]||[],p=a["attributes-"+n+"-value"]||[],q=0,r=Math.min(o.length,p.length);q<r;q++)if(o[q]&&p[q]){var s=k.indexOf(o[q])>-1?"":"data-";j[n][s+o[q]]=p[q]}delete a["attributes-"+n+"-value"],delete a["attributes-"+n+"-key"]}return a.attributes=j,a}function c(){return 0===b(this).closest(".ithoughts-prototype").length}function d(){var a=b(this),c=a.parent().parent(),d=c.find("input").filter(function(){return this!==a.get(0)});setTimeout(function(){var b=a.closest(".ithoughts-attrs-container").attr("data-attr-family");if(h[b])return void(h[b]=!1);a.val(a.val().trim()),d.val(d.val().trim()),a.val()||d.val()||document.activeElement===a.get(0)||document.activeElement===d.get(0)||c.remove()},100)}var e=b("#ithoughts_tt_gl-tooltip-form-options"),f=b("#ithoughts_tt_gl-tooltip-form"),h={span:!1,link:!1},i=b("#ithoughts_tt_gl-tooltip-form-options form");e.find('input[type="checkbox"].ithoughts-tristate').attr("data-state",function(a,b){return((b||0)-1)%3+2}).change(function(){var a=b(this),c=((a.attr("data-state")||0)-2)%3+1;a.attr("data-state",c),this.checked=1===c,this.indeterminate=0===c}).change(),b("#ithoughts_tt_gl-tinymce-advanced_options").click(function(){e.show(),f.hide()}),b("#ithoughts_tt_gl-tinymce-close-attrs").click(function(){e.hide(),f.show()}),b("#ithoughts_tt_gl-tinymce-validate-attrs").click(function(){g=a(),e.hide(),f.show()}),b("#qtip-keep-open").change(function(){var a,c=b("#qtiptrigger"),d=b("#qtiptriggerText"),e=b([c,d]);return function(){c.prop("disabled",this.checked),d.prop("disabled",!this.checked),e.val(this.checked?"click":a),this.checked?a=c.value:c.disabled=!(d.disabled=!0)}}()),b('[name^="position[my]"]').change(function(){var a="#position[my][",c=b(a+"1]"),d=b(a+"2]"),e=b(d.get(0),c.get(0)),f=b(a+"invert]");return function(){e.prop("required",c.val()||d.val()||f.prop("checked"))}}()),b('[name^="position[at]"]').change(function(){var a="#position[at][",c=b(a+"1]"),d=b(a+"2]"),e=b(d.get(0),c.get(0));return function(){e.prop("required",c.val()||d.val())}}()),b(".kv-pair-link-attrs-add,.kv-pair-span-attrs-add").bind("mouseup touchend",function(){var a=b(this).parent().find(".ithoughts-attrs-container"),e=a.find("input:invalid").filter(c),f=a.attr("data-attr-family");if(h[f]=!0,e.length>0)return h[f]=!0,e.eq(0).focus(),d.call(e.get(0)),void(h[f]=!1);var g=a.find(".ithoughts-prototype"),i=g.clone().removeClass("ithoughts-prototype"),j=["attributes-"+f+"-","-"+(new Date).getTime()];i.find(".dynamicId").each(function(){var a=b(this),c=j[0]+(a.hasClass("dynamicId-key")?"key":"value")+j[1];a.attr("LABEL"===this.tagName?"for":"id",c)}),a.append(i),i.find("input").prop("required",!0).prop("disabled",!1).blur(d).eq(0).focus(),d.call(i.find("input").get(0))}),b(".ithoughts-attrs-container input").blur(d),g=a()}(),b("#mediatip_url_video_link").bind("keyup mouseup change click focusin focusout",function(){var a,c=null,d=this.value,e={youtube:{regex:/^(?:https?:\/\/(?:youtu\.be\/|\w*\.youtube\.\w{2,3}\/watch\?v=)|<iframe .*?src="https?:\/\/\w*\.youtube\.\w{2,3}\/embed\/)([a-zA-Z0-9]*).*$/,embed:'<iframe width="512" height="288" src="https://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>',video:"https://www.youtube.com/watch?v=$1"},dailymotion:{regex:/^(?:https?:\/\/(?:dai\.ly\/|\w*\.dailymotion\.\w{2,3}\/video\/)|<iframe .*?src=".*?\w*\.dailymotion\.\w{2,3}\/embed\/video\/)([a-zA-Z0-9]*).*/,embed:'<iframe width="512" height="288" src="https://www.dailymotion.com/embed/video/$1" frameborder="0" allowfullscreen></iframe>',video:"https://www.dailymotion.com/video/$1"},direct:{regex:/^(.*\.mp4)(\?.*)?$/,embed:'<video width="512" height="288" controls="controls"><source src="$1" type="video/mp4" /></video>',video:"$1"}};for(var f in e)if(a=e[f],d.match(a.regex)){c={embed:d.replace(a.regex,a.embed),video:d.replace(a.regex,a.video)};break}c&&(b("#mediatip_url_video_embed").val(c.embed),b(this).val(c.video))}).keyup(),b("#ithoughts_tt_gl-tinymce-validate").click(function(){var a={type:["glossary","tooltip","mediatip"][b(".tabs li.active").index()],text:b("#ithoughts_tt_gl_text").val(),link:b("#ithoughts_tt_gl_link").val(),opts:g};switch(e.log("Before per-type form data handling:",a),a.type){case"glossary":a=b.extend(a,{glossary_id:b('[name="glossary_term_id"]').val(),disable_auto_translation:b('[name="glossary_disable_auto_translation"]').is(":checked")});break;case"tooltip":a=b.extend(a,{tooltip_content:tinymce.EditorManager.get("ithoughts_tt_gl-tooltip-content").getContent()||b("#ithoughts_tt_gl-tooltip-content").val()});break;case"mediatip":switch(a=b.extend(a,{mediatip_type:b("#mediatip_type").val()}),a.mediatip_type){case"localimage":a=b.extend(a,{mediatip_content:b("#image-box-data").val(),mediatip_caption:b("#mediatip_caption").val()});break;case"webimage":a=b.extend(a,{mediatip_content:b("#mediatip_url_image").val(),mediatip_caption:b("#mediatip_caption").val()});break;case"webvideo":a=b.extend(a,{mediatip_content:b("#mediatip_url_video_embed").val(),mediatip_link:b("#mediatip_url_video_link").val()})}}f(a)}),b(".ithoughts_tt_gl-tinymce-discard").click(f.bind(null,null))}():"LIST"===c&&function(){a(b(".tabs li")),function(){var a=b("#groups"),c=b("#groups_text"),e=b(".groupspicker"),f=b([e.get(0),c.parent().get(0)]),g=b(".groupspicker .group-select input");c.focusin(function(){function a(a){a.stopImmediatePropagation()}function b(){e.toggleClass("hidden"),f.off("click",a)}e.toggleClass("hidden"),f.click(a),d.one("click",b)}),g.change(function(){var d=g.filter(":checked"),e=[],f=[];d.each(function(){e.push(b(this).parent().find(".group-title").text()),f.push(b(this).val())}),a.val(f.join(",")),c.val(e.join(", "))}).change()}(),b("#ithoughts_tt_gl-tinymce-validate").click(function(){var a={type:["atoz","list"][b(".tabs li.active").index()],alpha:b("#letters").val(),group:b("#groups").val()};switch(a.alpha||delete a.alpha,a.group||delete a.group,a.type){case"list":b.extend(a,{desc:b("#description_mode").val(),cols:b("#columns_count").val()})}e.finishListTinymce(a)}),b(".ithoughts_tt_gl-tinymce-discard").click(function(){e.finishListTinymce()})}()})}(iThoughts.v5);/**/